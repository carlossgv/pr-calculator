generator client {
  provider      = "prisma-client"
  output        = "../src/generated/prisma"
  moduleFormat  = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  devices   Device[]
  preferences Preferences?
  movements Movement[]
  prEntries PrEntry[]
}

model Device {
  id         String   @id // deviceId
  accountId  String
  tokenHash  String
  createdAt  DateTime @default(now())
  lastSeenAt DateTime @default(now())
  appVersion String?

  account Account @relation(fields: [accountId], references: [id])

  @@index([accountId])
}

model Preferences {
  accountId  String   @id
  value      Json
  updatedAt  DateTime
  deletedAt  DateTime?

  account Account @relation(fields: [accountId], references: [id])
}

model Movement {
  id        String   @id
  accountId String
  value     Json
  updatedAt DateTime
  deletedAt DateTime?

  account Account @relation(fields: [accountId], references: [id])

  @@index([accountId, updatedAt])
}

model PrEntry {
  id        String   @id
  accountId String
  movementId String?
  value     Json
  updatedAt DateTime
  deletedAt DateTime?

  account Account @relation(fields: [accountId], references: [id])

  @@index([accountId, updatedAt])
  @@index([accountId, movementId, updatedAt])
}
